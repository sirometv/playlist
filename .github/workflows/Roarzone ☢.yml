name: Roarzone â˜¢

on:
  # à¦ªà§à¦°à¦¤à¦¿ à§« à¦®à¦¿à¦¨à¦¿à¦Ÿà§‡ à¦°à¦¾à¦¨ à¦•à¦°à¦¬à§‡
  schedule:
    - cron: '*/5 * * * *'
  # à¦®à§à¦¯à¦¾à¦¨à§à§Ÿà¦¾à¦²à¦¿ à¦šà¦¾à¦²à¦¾à¦¨à§‹à¦° à¦œà¦¨à§à¦¯
  workflow_dispatch:

jobs:
  sync-playlist:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          
      - name: Get current time
        id: time
        uses: josStorer/get-current-time@v2.0.2
        with:
          format: 'YYYY-MM-DD HH:mm:ss'
          timezone: 'Asia/Dhaka'
          
      - name: Fetch playlist from secret
        id: fetch-playlist
        run: |
          # à¦¸à¦¿à¦•à§à¦°à§‡à¦Ÿ à¦¥à§‡à¦•à§‡ à¦ªà§à¦²à§‡à¦²à¦¿à¦¸à§à¦Ÿ à¦²à¦¿à¦‚à¦• à¦ªà§œà¦¾
          if [ -z "${{ secrets.SIROMETV_ROARZONE }}" ]; then
            echo "Error: SIROMETV_ROARZONE secret is not set"
            exit 1
          fi
          
          # à¦ªà§à¦²à§‡à¦²à¦¿à¦¸à§à¦Ÿ à¦¡à¦¾à¦‰à¦¨à¦²à§‹à¦¡ à¦•à¦°à¦¾
          curl -s "${{ secrets.SIROMETV_ROARZONE }}" -o temp_playlist.m3u
          
          # à¦¹à§‡à¦¡à¦¾à¦° à¦¤à§ˆà¦°à¦¿ à¦•à¦°à¦¾
          echo "#EXTM3U" > roarzone.m3u
          echo "#ðŸ”´ à¦à¦‡ à¦«à¦¾à¦‡à¦²à§‡à¦° à¦¸à¦®à¦¸à§à¦¤ à¦²à¦¿à¦™à§à¦• à¦ªà¦¾à¦¬à¦²à¦¿à¦• à¦¸à§‹à¦°à§à¦¸ à¦¥à§‡à¦•à§‡ à¦¸à¦‚à¦—à§à¦°à¦¹ à¦•à¦°à¦¾ à¦¹à¦¯à¦¼à§‡à¦›à§‡à¥¤ à¦¯à¦¦à¦¿ à¦•à§‡à¦‰ à¦¤à¦¾à¦¦à§‡à¦° à¦¸à§‹à¦°à§à¦¸ à¦®à§à¦›à§‡ à¦«à§‡à¦²à¦¤à§‡ à¦šà¦¾à¦¨, à¦¤à¦¾à¦¹à¦²à§‡ à¦¦à¦¯à¦¼à¦¾ à¦•à¦°à§‡ à¦†à¦®à¦¾à¦¦à§‡à¦° à¦œà¦¾à¦¨à¦¾à¦¨à¥¤ à¦†à¦®à¦°à¦¾ à¦†à¦ªà¦¨à¦¾à¦° à¦®à¦¤à¦¾à¦®à¦¤ à¦à¦¬à¦‚ à¦ªà§à¦°à¦šà§‡à¦·à§à¦Ÿà¦¾à¦•à§‡ à¦¸à¦®à§à¦®à¦¾à¦¨ à¦•à¦°à¦¿, à¦¤à¦¾à¦‡ à¦†à¦ªà¦¨à¦¾à¦° à¦¸à§‹à¦°à§à¦¸ à¦®à§à¦›à§‡ à¦«à§‡à¦²à¦¾à¦° à¦¬à§à¦¯à¦¾à¦ªà¦¾à¦°à§‡ à¦†à¦®à¦°à¦¾ à¦†à¦ªà¦¤à§à¦¤à¦¿ à¦•à¦°à¦¬ à¦¨à¦¾ã€‚" >> roarzone.m3u
          echo "#ðŸ”´All the links in this file are collected from public sources. If anyone wants to remove their source, please let us know. We respect your opinions and efforts, so we will not object to removing your sourceã€‚" >> roarzone.m3u
          echo "#Update Time âœ”ï¸: ${{ steps.time.outputs.formattedTime }} (Bangladesh Time)" >> roarzone.m3u
          echo "#Telegram ðŸ”—: https://t.me/sirometv" >> roarzone.m3u
          echo "#WEB TV ðŸ“º: https://sirometv-tv.vercel.app" >> roarzone.m3u
          echo "" >> roarzone.m3u
          
          # à¦†à¦¸à¦² à¦ªà§à¦²à§‡à¦²à¦¿à¦¸à§à¦Ÿ à¦•à¦¨à§à¦Ÿà§‡à¦¨à§à¦Ÿ à¦¯à§‹à¦— à¦•à¦°à¦¾
          tail -n +2 temp_playlist.m3u >> roarzone.m3u
          
          # à¦«à¦¾à¦‡à¦² à¦¸à¦¾à¦‡à¦œ à¦šà§‡à¦•
          echo "Playlist size: $(wc -l < roarzone.m3u) lines"
          
      - name: Commit and push changes
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          
          # changes staged à¦•à¦°à¦¾
          git add roarzone.m3u
          
          # changes commit à¦•à¦°à¦¾
          if git diff --cached --quiet; then
            echo "No changes to commit"
          else
            git commit -m "ðŸ”„ Auto-update Roarzone playlist - ${{ steps.time.outputs.formattedTime }}"
            git push
            echo "Changes committed and pushed successfully"
          fi
