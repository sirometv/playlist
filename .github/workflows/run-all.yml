name: üöÄ Trigger All Workflows

on:
  schedule:
    - cron: '*/10 * * * *'  # ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡ßß‡ß¶ ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü‡ßá
  workflow_dispatch:

jobs:
  trigger-workflows:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: List all workflows
        run: |
          echo "üìã Available workflow files:"
          ls -la .github/workflows/*.yml
          echo ""
      
      - name: Trigger workflows one by one
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          echo "üöÄ Starting to trigger all workflows..."
          echo ""
          
          # Workflow ‡¶´‡¶æ‡¶á‡¶≤‡¶ó‡ßÅ‡¶≤‡ßã‡¶∞ ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü (‡¶®‡¶ø‡¶ú‡ßá‡¶ï‡ßá ‡¶¨‡¶æ‡¶¶ ‡¶¶‡¶ø‡ßü‡ßá)
          WORKFLOWS=(
            "AllChannelüîÑ.yml"
            "Ayna TV üîÑ.yml"
            "CRICHD JSON üü§.yml"
            "Combined Playlist Skipper üîÑ.yml"
            "CricHD üí†.yml"
            "Fancode JSON Data ‚úîÔ∏è.yml"
            "Fancode to M3U8.yml"
            "Fancode-BD-IND.yml"
            "LiveFancodeüîÑüîÑ.yml"
            "Sirome TV üü¢.yml"
            "Yupp TV üÜï.yml"
          )
          
          for workflow in "${WORKFLOWS[@]}"; do
            if [ ! -f ".github/workflows/$workflow" ]; then
              echo "‚ö†Ô∏è Skipping: $workflow (not found)"
              continue
            fi
            
            echo "‚ñ∂Ô∏è Triggering: $workflow"
            
            # Extract workflow name from file
            workflow_name=$(grep -oP 'name:\s*\K.*' ".github/workflows/$workflow" | head -1 | sed 's/^ *//;s/ *$//')
            
            if [ -z "$workflow_name" ]; then
              workflow_name="$workflow"
            fi
            
            echo "   Name: $workflow_name"
            
            # GitHub API call to trigger workflow
            response=$(curl -s -o response.txt -w "%{http_code}" \
              -X POST \
              -H "Authorization: token $GITHUB_TOKEN" \
              -H "Accept: application/vnd.github.v3+json" \
              "https://api.github.com/repos/sirometv/playlist/actions/workflows/$workflow/dispatches" \
              -d '{"ref":"main"}')
            
            if [ "$response" -eq 204 ]; then
              echo "   ‚úÖ Successfully triggered"
            else
              echo "   ‚ùå Failed to trigger (HTTP $response)"
              cat response.txt 2>/dev/null || true
            fi
            
            echo ""
            
            # Wait 3 seconds between triggers
            sleep 3
          done
          
          echo "üéâ Trigger process completed!"
          rm -f response.txt 2>/dev/null || true
      
      - name: Wait for workflows to complete
        run: |
          echo "‚è≥ Waiting 2 minutes for workflows to start..."
          sleep 120
          echo "‚úÖ Wait completed"
      
      - name: Check workflow status
        run: |
          echo "üìä Checking recent workflow runs..."
          echo ""
          
          curl -s \
            -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
            -H "Accept: application/vnd.github.v3+json" \
            "https://api.github.com/repos/sirometv/playlist/actions/runs?per_page=20" \
            | jq -r '.workflow_runs[] | "\(.name) - \(.status) - \(.conclusion) - \(.html_url)"' \
            | head -15 || echo "Could not fetch status"
