name: "All Workflows ğŸ”„"

on:
  schedule:
    - cron: '*/5 * * * *'
  workflow_dispatch:

permissions:
  contents: write

jobs:
  update-workflows:
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: ğŸ”§ Setup environment
        run: |
          mkdir -p .github/workflows
          echo "âœ… Setup completed"

      - name: ğŸ“¥ Download Combined Playlist Skipper
        run: |
          echo "Downloading Combined Playlist Skipper..."
          curl -s -L -o ".github/workflows/Combined Playlist Skipper ğŸŸ¢.yml" \
            "https://raw.githubusercontent.com/sirometv/playlist/refs/heads/main/.github/workflows/Combined%20Playlist%20Skipper%F0%9F%9F%A2.yml"
          
          # Schedule à¦†à¦¨à¦•à¦®à§‡à¦¨à§à¦Ÿ à¦•à¦°à§à¦¨
          sed -i "s/# schedule:/schedule:/g" ".github/workflows/Combined Playlist Skipper ğŸŸ¢.yml"
          sed -i "s/#   - cron: '\\/5 \\* \\* \\* \\*'/  - cron: '\\/5 * * * *'/g" ".github/workflows/Combined Playlist Skipper ğŸŸ¢.yml"
          
          echo "âœ… Downloaded and enabled schedule"

      - name: ğŸ“¥ Download LiveFancode
        run: |
          echo "Downloading LiveFancode..."
          curl -s -L -o ".github/workflows/LiveFancodeğŸ”ğŸ”.yml" \
            "https://raw.githubusercontent.com/sirometv/playlist/refs/heads/main/.github/workflows/LiveFancode%F0%9F%94%84%F0%9F%94%84.yml"
          
          # Schedule à¦†à¦¨à¦•à¦®à§‡à¦¨à§à¦Ÿ à¦•à¦°à§à¦¨
          sed -i "s/# schedule:/schedule:/g" ".github/workflows/LiveFancodeğŸ”ğŸ”.yml"
          sed -i "s/#   - cron: '\\/5 \\* \\* \\* \\*'/  - cron: '\\/5 * * * *'/g" ".github/workflows/LiveFancodeğŸ”ğŸ”.yml"
          
          echo "âœ… Downloaded and enabled schedule"

      - name: ğŸ“¥ Download Ayna TV
        run: |
          echo "Downloading Ayna TV..."
          curl -s -L -o ".github/workflows/Ayna TV ğŸ”.yml" \
            "https://raw.githubusercontent.com/sirometv/playlist/refs/heads/main/.github/workflows/Ayna%20TV%20%F0%9F%94%84.yml"
          
          # Schedule à¦†à¦¨à¦•à¦®à§‡à¦¨à§à¦Ÿ à¦•à¦°à§à¦¨
          sed -i "s/# schedule:/schedule:/g" ".github/workflows/Ayna TV ğŸ”.yml"
          sed -i "s/#   - cron: '\\/5 \\* \\* \\* \\*'/  - cron: '\\/5 * * * *'/g" ".github/workflows/Ayna TV ğŸ”.yml"
          
          echo "âœ… Downloaded and enabled schedule"

      - name: ğŸ“¥ Download CricHD
        run: |
          echo "Downloading CricHD..."
          curl -s -L -o ".github/workflows/CricHD ğŸ’ .yml" \
            "https://raw.githubusercontent.com/sirometv/playlist/refs/heads/main/.github/workflows/CricHD%20%F0%9F%92%A0.yml"
          
          # Schedule à¦†à¦¨à¦•à¦®à§‡à¦¨à§à¦Ÿ à¦•à¦°à§à¦¨
          sed -i "s/# schedule:/schedule:/g" ".github/workflows/CricHD ğŸ’ .yml"
          sed -i "s/#   - cron: '\\/5 \\* \\* \\* \\*'/  - cron: '\\/5 * * * *'/g" ".github/workflows/CricHD ğŸ’ .yml"
          
          echo "âœ… Downloaded and enabled schedule"

      - name: ğŸ“¥ Download CRICHD JSON
        run: |
          echo "Downloading CRICHD JSON..."
          curl -s -L -o ".github/workflows/CRICHD JSON ğŸŸ¤.yml" \
            "https://raw.githubusercontent.com/sirometv/playlist/refs/heads/main/.github/workflows/CRICHD%20JSON%20%F0%9F%9F%A4.yml"
          
          # Schedule à¦†à¦¨à¦•à¦®à§‡à¦¨à§à¦Ÿ à¦•à¦°à§à¦¨
          sed -i "s/# schedule:/schedule:/g" ".github/workflows/CRICHD JSON ğŸŸ¤.yml"
          sed -i "s/#   - cron: '\\/5 \\* \\* \\* \\*'/  - cron: '\\/5 * * * *'/g" ".github/workflows/CRICHD JSON ğŸŸ¤.yml"
          
          echo "âœ… Downloaded and enabled schedule"

      - name: âœ… Verify downloaded files
        run: |
          echo "ğŸ“ List of downloaded workflow files:"
          ls -la .github/workflows/
          
          echo ""
          echo "ğŸ” Checking schedules in each file:"
          for file in .github/workflows/*.yml; do
            echo ""
            echo "=== $(basename "$file") ==="
            if grep -q "schedule:" "$file"; then
              echo "âœ… Schedule: ENABLED"
              grep "cron:" "$file"
            else
              echo "âŒ Schedule: NOT FOUND"
            fi
          done

      - name: ğŸ“ Commit and push changes
        run: |
          git config --local user.name "github-actions[bot]"
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          
          # à¦¶à§à¦§à§ à¦ªà¦°à¦¿à¦¬à¦°à§à¦¤à¦¿à¦¤ à¦«à¦¾à¦‡à¦²à¦—à§à¦²à§‹ à¦¯à§‹à¦— à¦•à¦°à§à¦¨
          git add .github/workflows/
          
          # à¦ªà¦°à¦¿à¦¬à¦°à§à¦¤à¦¨ à¦šà§‡à¦• à¦•à¦°à§à¦¨
          if git diff --staged --quiet; then
            echo "â„¹ï¸ No changes to commit"
          else
            git commit -m "ğŸ”„ Auto-update workflows via 'All Workflows ğŸ”„'
            
            Updated workflow files:
            â€¢ Combined Playlist Skipper ğŸŸ¢.yml
            â€¢ LiveFancodeğŸ”ğŸ”.yml
            â€¢ Ayna TV ğŸ”.yml
            â€¢ CricHD ğŸ’ .yml
            â€¢ CRICHD JSON ğŸŸ¤.yml
            
            ğŸ“… All workflows now run every 5 minutes
            âœ… Updated by github-actions[bot]"
            
            git push
            echo "âœ… Successfully pushed updates!"
          fi

      - name: ğŸ‰ Completion message
        run: |
          echo "========================================"
          echo "âœ… WORKFLOW COMPLETED SUCCESSFULLY!"
          echo "========================================"
          echo ""
          echo "ğŸ“Š Summary:"
          echo "â€¢ 5 workflow files downloaded"
          echo "â€¢ Schedules enabled (every 5 minutes)"
          echo "â€¢ Changes committed and pushed"
          echo ""
          echo "â° Next auto-run: In 5 minutes"
          echo "ğŸ”§ Manual trigger: Available"
          echo "========================================"
