name: All Workflows ЁЯФД

on:
  schedule:
    - cron: '*/5 * * * *'  # ржкрзНрж░рждрж┐ рзл ржорж┐ржирж┐ржЯ ржкрж░ржкрж░
  workflow_dispatch:  # ржорзНржпрж╛ржирзБрзЯрж╛рж▓рж┐ рж░рж╛ржи ржХрж░рж╛рж░ ржЕржкрж╢ржи

jobs:
  update-all-workflows:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        
      - name: Get all workflow files
        id: get-files
        run: |
          # рж╢рзБржзрзБ .yml ржПржмржВ .yaml ржлрж╛ржЗрж▓ржЧрзБрж▓рзЛ ржирзЗрзЯрж╛
          files=$(find .github/workflows -name "*.yml" -o -name "*.yaml")
          # All Workflows ЁЯФД ржлрж╛ржЗрж▓ржЯрж╛ ржмрж╛ржж ржжрж┐рждрзЗ рж╣ржмрзЗ ржпрзЗржи рж╕рзЗрж▓ржл рж▓рзБржк ржирж╛ рж╣рзЯ
          files=$(echo "$files" | grep -v "All Workflows ЁЯФД")
          echo "files_to_update<<EOF" >> $GITHUB_OUTPUT
          echo "$files" >> $GITHUB_OUTPUT
          echo "EOF" >> $GITHUB_OUTPUT
          
      - name: Update all workflows
        if: steps.get-files.outputs.files != ''
        run: |
          files="${{ steps.get-files.outputs.files }}"
          
          # ржкрзНрж░рждрж┐ржЯрж┐ ржлрж╛ржЗрж▓рзЗрж░ ржЬржирзНржп
          for file in $files; do
            if [ -f "$file" ]; then
              echo "Updating: $file"
              
              # ржлрж╛ржЗрж▓рзЗрж░ рж╢рзЗрж╖ modification timestamp ржкрж░рж┐ржмрж░рзНрждржи
              touch "$file"
              
              # ржЕржержмрж╛ ржпржжрж┐ Git commit history рждрзЗ ржкрж░рж┐ржмрж░рзНрждржи ржжрзЗржЦрж╛рждрзЗ ржЪрж╛ржи
              echo "# Updated by All Workflows action at $(date)" >> "$file"
              echo "" >> "$file"
            fi
          done
          
      - name: Commit changes
        if: steps.get-files.outputs.files != ''
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add .github/workflows/
          git commit -m "ЁЯФД Auto-update all workflows [skip ci]" || echo "No changes to commit"
          
      - name: Push changes
        if: steps.get-files.outputs.files != ''
        uses: ad-m/github-push-action@master
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          branch: ${{ github.ref }}
