name: All Workflows üîÑ

on:
  schedule:
    - cron: '*/5 * * * *'
  workflow_dispatch:
  push:
    paths:
      - '.github/workflows/sync-workflows.yml'

jobs:
  sync-workflows:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: Sync Workflows
        run: |
          #!/bin/bash
          
          # ‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶ï‡¶´‡ßç‡¶≤‡ßã ‡¶´‡¶æ‡¶á‡¶≤‡ßá‡¶∞ URL ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü - ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶Ü‡¶™‡¶®‡¶ø ‡¶®‡¶§‡ßÅ‡¶® ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®
          WORKFLOW_URLS=(
            "https://raw.githubusercontent.com/sirometv/playlist/refs/heads/main/.github/workflows/Combined%20Playlist%20Skipper%F0%9F%9F%A2.yml"
            "https://raw.githubusercontent.com/sirometv/playlist/refs/heads/main/.github/workflows/LiveFancode%F0%9F%94%84%F0%9F%94%84.yml"
            "https://raw.githubusercontent.com/sirometv/playlist/refs/heads/main/.github/workflows/Ayna%20TV%20%F0%9F%94%84.yml"
            "https://raw.githubusercontent.com/sirometv/playlist/refs/heads/main/.github/workflows/CricHD%20%F0%9F%92%A0.yml"
            "https://raw.githubusercontent.com/sirometv/playlist/refs/heads/main/.github/workflows/CRICHD%20JSON%20%F0%9F%9F%A4.yml"
            # --- ‡¶®‡¶§‡ßÅ‡¶® ‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶ï‡¶´‡ßç‡¶≤‡ßã ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡¶§‡ßá ‡¶®‡¶ø‡¶ö‡ßá ‡¶≤‡¶æ‡¶á‡¶® ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶® ---
            # "YOUR_NEW_WORKFLOW_URL_HERE"
          )
          
          # ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶è‡¶¨‡¶Ç ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø Python ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡ßç‡¶ü
          python3 -c "
          import urllib.request
          import os
          import yaml
          import json
          from pathlib import Path
          
          workflow_urls = [
              'https://raw.githubusercontent.com/sirometv/playlist/refs/heads/main/.github/workflows/Combined%20Playlist%20Skipper%F0%9F%9F%A2.yml',
              'https://raw.githubusercontent.com/sirometv/playlist/refs/heads/main/.github/workflows/LiveFancode%F0%9F%94%84%F0%9F%94%84.yml',
              'https://raw.githubusercontent.com/sirometv/playlist/refs/heads/main/.github/workflows/Ayna%20TV%20%F0%9F%94%84.yml',
              'https://raw.githubusercontent.com/sirometv/playlist/refs/heads/main/.github/workflows/CricHD%20%F0%9F%92%A0.yml',
              'https://raw.githubusercontent.com/sirometv/playlist/refs/heads/main/.github/workflows/CRICHD%20JSON%20%F0%9F%9F%A4.yml',
              # ‡¶®‡¶§‡ßÅ‡¶® ‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶ï‡¶´‡ßç‡¶≤‡ßã URL ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®
          ]
          
          for url in workflow_urls:
              try:
                  # ‡¶´‡¶æ‡¶á‡¶≤‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶è‡¶ï‡ßç‡¶∏‡¶ü‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®
                  filename = url.split('/')[-1]
                  # URL ‡¶°‡¶ø‡¶ï‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®
                  import urllib.parse
                  filename = urllib.parse.unquote(filename)
                  
                  print(f'Processing: {filename}')
                  
                  # YML ‡¶´‡¶æ‡¶á‡¶≤ ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®
                  response = urllib.request.urlopen(url)
                  content = response.read().decode('utf-8')
                  
                  # YAML ‡¶™‡¶æ‡¶∞‡ßç‡¶∏ ‡¶ï‡¶∞‡ßÅ‡¶®
                  workflow_data = yaml.safe_load(content)
                  
                  # ‡¶∂‡¶ø‡¶°‡¶ø‡¶â‡¶≤‡ßç‡¶° ‡¶ü‡ßç‡¶∞‡¶ø‡¶ó‡¶æ‡¶∞ ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶® (‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡ß´ ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü)
                  if 'on' in workflow_data:
                      if 'schedule' not in workflow_data['on']:
                          workflow_data['on']['schedule'] = [{'cron': '*/5 * * * *'}]
                      else:
                          # ‡¶∂‡¶ø‡¶°‡¶ø‡¶â‡¶≤ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®
                          for schedule in workflow_data['on']['schedule']:
                              schedule['cron'] = '*/5 * * * *'
                  
                  # ‡¶Ü‡¶™‡¶°‡ßá‡¶ü‡ßá‡¶° YAML ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®
                  updated_content = yaml.dump(workflow_data, default_flow_style=False, allow_unicode=True)
                  
                  # ‡¶´‡¶æ‡¶á‡¶≤ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®
                  workflow_path = Path('.github/workflows') / filename
                  workflow_path.parent.mkdir(parents=True, exist_ok=True)
                  
                  with open(workflow_path, 'w', encoding='utf-8') as f:
                      f.write(updated_content)
                      
                  print(f'‚úì Updated: {filename}')
                  
              except Exception as e:
                  print(f'‚úó Error processing {url}: {str(e)}')
          "
          
          # Git ‡¶ï‡¶Æ‡¶ø‡¶ü ‡¶è‡¶¨‡¶Ç ‡¶™‡ßÅ‡¶∂
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          
          # ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®‡¶ó‡ßÅ‡¶≤‡¶ø ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®
          if git diff --quiet; then
            echo "No changes detected"
          else
            git add .github/workflows/
            git commit -m "üîÑ Auto-sync workflows: $(date +'%Y-%m-%d %H:%M:%S')"
            git push origin main
            echo "‚úì Workflows updated and pushed successfully"
          fi

      - name: Verify Updates
        run: |
          echo "üìã Updated workflow files:"
          ls -la .github/workflows/
          echo ""
          echo "üïí Next run will be in 5 minutes"
