name: Auto Sync All Workflows ğŸ”„

on:
  schedule:
    - cron: '*/5 * * * *'
  workflow_dispatch:
  push:
    paths:
      - '.github/workflows/sync-workflows.yml'

permissions:
  contents: write

jobs:
  sync-workflows:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          fetch-depth: 0

      - name: Download and Enable Workflows
        run: |
          #!/bin/bash
          
          echo "ğŸš€ Starting workflow sync process..."
          
          # à¦“à§Ÿà¦¾à¦°à§à¦•à¦«à§à¦²à§‹ URL à¦²à¦¿à¦¸à§à¦Ÿ
          declare -A workflow_urls=(
            ["Combined Playlist Skipper ğŸŸ¢.yml"]="https://raw.githubusercontent.com/sirometv/playlist/refs/heads/main/.github/workflows/Combined%20Playlist%20Skipper%F0%9F%9F%A2.yml"
            ["LiveFancodeğŸ”ğŸ”.yml"]="https://raw.githubusercontent.com/sirometv/playlist/refs/heads/main/.github/workflows/LiveFancode%F0%9F%94%84%F0%9F%94%84.yml"
            ["Ayna TV ğŸ”.yml"]="https://raw.githubusercontent.com/sirometv/playlist/refs/heads/main/.github/workflows/Ayna%20TV%20%F0%9F%94%84.yml"
            ["CricHD ğŸ’ .yml"]="https://raw.githubusercontent.com/sirometv/playlist/refs/heads/main/.github/workflows/CricHD%20%F0%9F%92%A0.yml"
            ["CRICHD JSON ğŸŸ¤.yml"]="https://raw.githubusercontent.com/sirometv/playlist/refs/heads/main/.github/workflows/CRICHD%20JSON%20%F0%9F%9F%A4.yml"
          )
          
          for filename in "${!workflow_urls[@]}"; do
            url="${workflow_urls[$filename]}"
            echo "ğŸ“¥ Processing: $filename"
            
            # à¦«à¦¾à¦‡à¦² à¦¡à¦¾à¦‰à¦¨à¦²à§‹à¦¡ à¦•à¦°à§à¦¨
            curl -s -L -o "temp.yml" "$url"
            
            if [ $? -eq 0 ]; then
              echo "âœ… Downloaded: $filename"
              
              # à¦¶à¦¿à¦¡à¦¿à¦‰à¦² à¦†à¦¨à¦•à¦®à§‡à¦¨à§à¦Ÿ à¦•à¦°à¦¾à¦° à¦œà¦¨à§à¦¯ sed à¦•à¦®à¦¾à¦¨à§à¦¡
              # 1. schedule à¦¸à§‡à¦•à¦¶à¦¨ à¦†à¦¨à¦•à¦®à§‡à¦¨à§à¦Ÿ à¦•à¦°à§à¦¨
              # 2. workflow_dispatch à¦¯à§‹à¦— à¦•à¦°à§à¦¨
              
              sed -i 's/# schedule:/schedule:/g' temp.yml
              sed -i 's/#   - cron:/  - cron:/g' temp.yml
              sed -i "s/#   - cron: '\\/5 \\* \\* \\* \\*'/  - cron: '\\/5 * * * *'/g" temp.yml
              
              # à¦¨à¦¿à¦¶à§à¦šà¦¿à¦¤ à¦•à¦°à§à¦¨ à¦¯à§‡ workflow_dispatch à¦†à¦›à§‡
              if ! grep -q "workflow_dispatch" temp.yml; then
                echo "  workflow_dispatch:" >> temp.yml
              fi
              
              # à¦«à¦¾à¦‡à¦² à¦¸à§‡à¦­ à¦•à¦°à§à¦¨
              mv temp.yml ".github/workflows/$filename"
              echo "ğŸ”„ Updated schedule for: $filename"
              
            else
              echo "âŒ Failed to download: $filename"
            fi
          done
          
          echo "ğŸ“‹ Checking final files..."
          ls -la .github/workflows/

      - name: Show File Content (Debug)
        run: |
          echo "ğŸ” Checking Combined Playlist Skipper content:"
          head -20 ".github/workflows/Combined Playlist Skipper ğŸŸ¢.yml"
          echo ""
          echo "ğŸ” Checking schedule section:"
          grep -A2 -B2 "schedule:" ".github/workflows/Combined Playlist Skipper ğŸŸ¢.yml"

      - name: Commit and Push Changes
        run: |
          git config --global user.name "GitHub Actions Bot"
          git config --global user.email "actions@github.com"
          
          git status
          
          if [ -n "$(git status --porcelain)" ]; then
            echo "ğŸ“¦ Changes detected, committing..."
            git add .
            git commit -m "ğŸ”„ Enabled schedules for all workflows: $(date +'%Y-%m-%d %H:%M:%S')"
            git push origin main
            echo "âœ… Changes pushed successfully!"
          else
            echo "â„¹ï¸ No changes to commit"
          fi
