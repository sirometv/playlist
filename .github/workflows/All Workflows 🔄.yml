name: "Update All Workflows"

on:
  workflow_dispatch:
  schedule:
    - cron: '*/5 * * * *'

jobs:
  update-workflows:
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸš€ Start Process
        run: echo "Starting workflow update process..."
      
      - name: ğŸ“¥ Checkout Repository
        uses: actions/checkout@v3
      
      - name: ğŸ“‚ Create Workflows Directory
        run: mkdir -p .github/workflows
      
      - name: â¬‡ï¸ Download Workflow 1
        run: |
          curl -s -o "workflow1.yml" \
          "https://raw.githubusercontent.com/sirometv/playlist/refs/heads/main/.github/workflows/Combined%20Playlist%20Skipper%F0%9F%9F%A2.yml"
          
          # Fix schedule
          sed -i 's/# schedule:/schedule:/' workflow1.yml
          sed -i "s/#   - cron: '\\/5 \\* \\* \\* \\*'/  - cron: '\\/5 * * * *'/" workflow1.yml
          
          mv workflow1.yml ".github/workflows/Combined Playlist Skipper ğŸŸ¢.yml"
          echo "âœ… Downloaded: Combined Playlist Skipper"
      
      - name: â¬‡ï¸ Download Workflow 2
        run: |
          curl -s -o "workflow2.yml" \
          "https://raw.githubusercontent.com/sirometv/playlist/refs/heads/main/.github/workflows/LiveFancode%F0%9F%94%84%F0%9F%94%84.yml"
          
          sed -i 's/# schedule:/schedule:/' workflow2.yml
          sed -i "s/#   - cron: '\\/5 \\* \\* \\* \\*'/  - cron: '\\/5 * * * *'/" workflow2.yml
          
          mv workflow2.yml ".github/workflows/LiveFancodeğŸ”ğŸ”.yml"
          echo "âœ… Downloaded: LiveFancode"
      
      - name: â¬‡ï¸ Download Workflow 3
        run: |
          curl -s -o "workflow3.yml" \
          "https://raw.githubusercontent.com/sirometv/playlist/refs/heads/main/.github/workflows/Ayna%20TV%20%F0%9F%94%84.yml"
          
          sed -i 's/# schedule:/schedule:/' workflow3.yml
          sed -i "s/#   - cron: '\\/5 \\* \\* \\* \\*'/  - cron: '\\/5 * * * *'/" workflow3.yml
          
          mv workflow3.yml ".github/workflows/Ayna TV ğŸ”.yml"
          echo "âœ… Downloaded: Ayna TV"
      
      - name: â¬‡ï¸ Download Workflow 4
        run: |
          curl -s -o "workflow4.yml" \
          "https://raw.githubusercontent.com/sirometv/playlist/refs/heads/main/.github/workflows/CricHD%20%F0%9F%92%A0.yml"
          
          sed -i 's/# schedule:/schedule:/' workflow4.yml
          sed -i "s/#   - cron: '\\/5 \\* \\* \\* \\*'/  - cron: '\\/5 * * * *'/" workflow4.yml
          
          mv workflow4.yml ".github/workflows/CricHD ğŸ’ .yml"
          echo "âœ… Downloaded: CricHD"
      
      - name: â¬‡ï¸ Download Workflow 5
        run: |
          curl -s -o "workflow5.yml" \
          "https://raw.githubusercontent.com/sirometv/playlist/refs/heads/main/.github/workflows/CRICHD%20JSON%20%F0%9F%9F%A4.yml"
          
          sed -i 's/# schedule:/schedule:/' workflow5.yml
          sed -i "s/#   - cron: '\\/5 \\* \\* \\* \\*'/  - cron: '\\/5 * * * *'/" workflow5.yml
          
          mv workflow5.yml ".github/workflows/CRICHD JSON ğŸŸ¤.yml"
          echo "âœ… Downloaded: CRICHD JSON"
      
      - name: âœ… Verify Files
        run: |
          echo "ğŸ“ Files in .github/workflows/:"
          ls -la .github/workflows/
          echo ""
          echo "ğŸ“‹ File count: $(ls .github/workflows/ | wc -l) files"
      
      - name: ğŸ“ Setup Git
        run: |
          git config --local user.name "GitHub Actions"
          git config --local user.email "actions@github.com"
      
      - name: ğŸ’¾ Commit Changes
        run: |
          git add .github/workflows/
          
          if ! git diff --cached --quiet; then
            git commit -m "ğŸ”„ Update workflow files with schedule"
            echo "âœ… Changes committed"
          else
            echo "â„¹ï¸ No changes to commit"
          fi
      
      - name: ğŸš€ Push Changes
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          if git log origin/main..HEAD --oneline | grep -q "."; then
            git push https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }}.git
            echo "âœ… Changes pushed successfully"
          else
            echo "â„¹ï¸ Nothing to push"
          fi
      
      - name: ğŸ‰ Complete
        run: |
          echo "======================================"
          echo "âœ… WORKFLOW COMPLETED SUCCESSFULLY!"
          echo "======================================"
          echo "ğŸ“Š Summary:"
          echo "â€¢ 5 workflow files updated"
          echo "â€¢ Schedules enabled (every 5 minutes)"
          echo "â€¢ All files saved to .github/workflows/"
          echo ""
          echo "â° Next auto-run in 5 minutes"
          echo "======================================"
