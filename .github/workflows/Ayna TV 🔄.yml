name: Ayna TV ЁЯФД 

on:
  schedule:
    # ржкрзНрж░рждрж┐ рзл ржорж┐ржирж┐ржЯ ржкрж░ ржкрж░ ржЖржкржбрзЗржЯ рж╣ржмрзЗ
    - cron: '*/5 * * * *'
  workflow_dispatch:  # ржорзНржпрж╛ржирзБржпрж╝рж╛рж▓рж┐ рж░рж╛ржи ржХрж░рж╛рж░ ржЕржкрж╢ржи

permissions:
  contents: write

jobs:
  sync-ayna:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        
    - name: Setup Bangladesh timezone
      run: |
        echo "ЁЯМП Setting up Bangladesh timezone..."
        # ржмрж╛ржВрж▓рж╛ржжрзЗрж╢рзЗрж░ ржЯрж╛ржЗржоржЬрзЛржи рж╕рзЗржЯ ржЖржк
        sudo timedatectl set-timezone Asia/Dhaka
        echo "тЬЕ Bangladesh timezone set: $(date)"
        
    - name: Download original playlist
      run: |
        echo "ЁЯФД Starting Ayna TV playlist sync..."
        echo "ЁЯУе Downloading from secure source..."
        echo "ЁЯУК Using variable: AYNA_SIROMETV"
        
        # Repository variable ржерзЗржХрзЗ URL ржкржбрж╝рж╛
        SOURCE_URL="${{ vars.AYNA_SIROMETV }}"
        echo "ЁЯФЧ Source URL length: ${#SOURCE_URL} characters"
        
        if [ -z "$SOURCE_URL" ]; then
          echo "тЭМ ERROR: AYNA_SIROMETV variable is empty!"
          exit 1
        fi
        
        # ржнрзЗрж░рж┐ржпрж╝рзЗржмрж▓ ржерзЗржХрзЗ URL ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржкрзНрж▓рзЗрж▓рж┐рж╕рзНржЯ ржбрж╛ржЙржирж▓рзЛржб
        curl -s -L -o original_playlist.m3u "$SOURCE_URL"
        
        # ржбрж╛ржЙржирж▓рзЛржб рж╕ржлрж▓ рж╣рзЯрзЗржЫрзЗ ржХрж┐ржирж╛ ржЪрзЗржХ
        if [ ! -f "original_playlist.m3u" ] || [ ! -s "original_playlist.m3u" ]; then
          echo "тЭМ ERROR: Playlist download failed!"
          echo "ЁЯУЛ Check if the URL in AYNA_SIROMETV variable is valid"
          exit 1
        fi
        
        ORIGINAL_LINES=$(wc -l < original_playlist.m3u)
        echo "тЬЕ Download successful - $ORIGINAL_LINES lines"
