name: ğŸ” Debug Workflows

on:
  workflow_dispatch:  # à¦¶à§à¦§à§ à¦®à§à¦¯à¦¾à¦¨à§à¦¯à¦¼à¦¾à¦²à¦¿ à¦šà¦¾à¦²à¦¾à¦¤à§‡ à¦ªà¦¾à¦°à¦¬à§‡à¦¨

jobs:
  debug-and-check:
    runs-on: ubuntu-latest
    
    steps:
      - name: à§§. Repository checkout à¦•à¦°à§à¦¨
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # à¦¸à¦¬ history à¦¨à¦¿à¦¬à§‡
      
      - name: à§¨. Workflow à¦¡à¦¿à¦°à§‡à¦•à§à¦Ÿà¦°à¦¿ à¦šà§‡à¦• à¦•à¦°à§à¦¨
        run: |
          echo "=========================================="
          echo "        ğŸ“ WORKFLOW DIRECTORY INFO        "
          echo "=========================================="
          echo ""
          
          echo "ğŸ“ Current directory:"
          pwd
          
          echo ""
          echo "ğŸ“‚ .github/workflows directory exists?"
          if [ -d ".github/workflows" ]; then
            echo "âœ… Yes, directory exists"
          else
            echo "âŒ No, directory doesn't exist"
            exit 1
          fi
          
          echo ""
          echo "ğŸ“‹ List of ALL files in workflows directory:"
          ls -la .github/workflows/
          
          echo ""
          echo "ğŸ”¢ Number of YML files:"
          ls .github/workflows/*.yml 2>/dev/null | wc -l || echo "0"
      
      - name: à§©. à¦ªà§à¦°à¦¤à¦¿à¦Ÿà¦¿ YML à¦«à¦¾à¦‡à¦²à§‡à¦° à¦¡à¦¿à¦Ÿà§‡à¦‡à¦²à¦¸ à¦¦à§‡à¦–à§à¦¨
        run: |
          echo ""
          echo "=========================================="
          echo "        ğŸ“„ WORKFLOW FILES CONTENT         "
          echo "=========================================="
          echo ""
          
          TOTAL_FILES=0
          for file in .github/workflows/*.yml; do
            if [ -f "$file" ]; then
              TOTAL_FILES=$((TOTAL_FILES + 1))
              echo ""
              echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
              echo "ğŸ“„ FILE #$TOTAL_FILES: $(basename $file)"
              echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
              echo ""
              
              # à¦«à¦¾à¦‡à¦²à§‡à¦° à¦ªà§à¦°à¦¥à¦® 30 à¦²à¦¾à¦‡à¦¨ à¦¦à§‡à¦–à¦¾à¦¨
              echo "ğŸ“ First 30 lines of the file:"
              echo "----------------------------------------"
              head -30 "$file"
              echo "----------------------------------------"
              
              # à¦—à§à¦°à§à¦¤à§à¦¬à¦ªà§‚à¦°à§à¦£ keywords à¦šà§‡à¦• à¦•à¦°à§à¦¨
              echo ""
              echo "ğŸ” Important sections found:"
              echo "----------------------------------------"
              
              if grep -q "name:" "$file"; then
                echo "âœ… Has 'name:'"
                grep -i "name:" "$file" | head -2
              else
                echo "âŒ No 'name:' found"
              fi
              
              if grep -q "on:" "$file"; then
                echo "âœ… Has 'on:'"
                grep -i "on:" "$file" -A 2 | head -5
              else
                echo "âŒ No 'on:' found"
              fi
              
              if grep -q "schedule:" "$file"; then
                echo "âœ… Has 'schedule:'"
                grep -i "schedule:" "$file" -A 2
              else
                echo "âŒ No 'schedule:' found"
              fi
              
              if grep -q "cron:" "$file"; then
                echo "âœ… Has 'cron:'"
                grep -i "cron:" "$file"
              else
                echo "âŒ No 'cron:' found"
              fi
              
              echo "----------------------------------------"
            fi
          done
          
          echo ""
          echo "ğŸ“Š SUMMARY:"
          echo "Total YML files found: $TOTAL_FILES"
          if [ $TOTAL_FILES -eq 0 ]; then
            echo "âŒ ERROR: No workflow files found!"
          fi
      
      - name: à§ª. Git status à¦šà§‡à¦• à¦•à¦°à§à¦¨
        run: |
          echo ""
          echo "=========================================="
          echo "          ğŸ”„ GIT INFORMATION              "
          echo "=========================================="
          echo ""
          
          echo "ğŸ“Œ Current branch:"
          git branch --show-current
          
          echo ""
          echo "ğŸ“Œ Git status:"
          git status --short
          
          echo ""
          echo "ğŸ“Œ Last commit:"
          git log --oneline -1
      
      - name: à§«. Complete report à¦¤à§ˆà¦°à¦¿ à¦•à¦°à§à¦¨
        run: |
          echo ""
          echo "=========================================="
          echo "           ğŸ¯ ACTION ITEMS               "
          echo "=========================================="
          echo ""
          echo "Based on the debug output:"
          echo ""
          echo "1. âœ… First, check if workflow files exist"
          echo "2. âœ… Check each file's structure"
          echo "3. âœ… Note which files have 'on:' section"
          echo "4. âœ… See if any files already have schedule"
          echo ""
          echo "Next steps:"
          echo "â€¢ Share this output with the assistant"
          echo "â€¢ We can create the correct scheduler"
          echo "â€¢ We'll know exactly what to fix!"
