name: All workflowüëå

on:
  schedule:
    - cron: '*/10 * * * *'  # ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡ßß‡ß¶ ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü ‡¶™‡¶∞
  workflow_dispatch:

jobs:
  add-schedule-to-all:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Add schedule to all workflow files
        run: |
          cd .github/workflows
          
          for file in *.yml; do
            # ‡¶®‡¶ø‡¶ú‡ßá‡¶ï‡ßá ‡¶¨‡¶æ‡¶¶ ‡¶¶‡¶ø‡¶®
            if [ "$file" = "update-all-workflows.yml" ]; then
              continue
            fi
            
            echo "Processing: $file"
            
            # ‡¶´‡¶æ‡¶á‡¶≤‡ßá schedule ‡¶Ü‡¶õ‡ßá ‡¶ï‡¶ø‡¶®‡¶æ ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®
            if grep -q "schedule:" "$file"; then
              echo "Schedule already exists in $file, updating..."
              # existing schedule ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®
              sed -i 's/cron:.*/cron: "\/\*\/10 * * * *"/g' "$file"
            else
              echo "Adding new schedule to $file"
              
              # Temporary file ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®
              temp_file=$(mktemp)
              
              # YML ‡¶´‡¶æ‡¶á‡¶≤ ‡¶™‡¶æ‡¶∞‡ßç‡¶∏ ‡¶ï‡¶∞‡ßá schedule ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®
              python3 << EOF
import yaml
import sys

with open('$file', 'r') as f:
    content = yaml.safe_load(f) or {}

# schedule ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®
if 'on' in content:
    if isinstance(content['on'], dict):
        content['on']['schedule'] = [{'cron': '*/10 * * * *'}]
    else:
        # ‡¶Ø‡¶¶‡¶ø 'on' string ‡¶¨‡¶æ list ‡¶π‡ßü
        current_on = content['on']
        content['on'] = {
            'schedule': [{'cron': '*/10 * * * *'}]
        }
        if current_on:
            content['on'].update(current_on)
else:
    content['on'] = {
        'schedule': [{'cron': '*/10 * * * *'}]
    }

# YAML ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨‡ßá ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®
with open('$temp_file', 'w') as f:
    yaml.dump(content, f, default_flow_style=False, sort_keys=False)

EOF
              
              # ‡¶Æ‡ßÇ‡¶≤ ‡¶´‡¶æ‡¶á‡¶≤‡¶ï‡ßá backup ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶®‡¶§‡ßÅ‡¶® content ‡¶¶‡¶ø‡ßü‡ßá replace ‡¶ï‡¶∞‡ßÅ‡¶®
              cp "$file" "$file.bak"
              cat "$temp_file" > "$file"
              rm "$temp_file"
              
              # ‡¶´‡¶∞‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ü ‡¶†‡¶ø‡¶ï ‡¶∞‡¶æ‡¶ñ‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ï‡¶ø‡¶õ‡ßÅ cleaning
              sed -i "s/''on'':/on:/g" "$file"
              sed -i "s/''schedule'':/schedule:/g" "$file"
              sed -i "s/''cron'':/cron:/g" "$file"
            fi
          done
      
      - name: Commit and push changes
        run: |
          git config --global user.name 'GitHub Action'
          git config --global user.email 'action@github.com'
          git add .github/workflows/*.yml
          
          if git diff --staged --quiet; then
            echo "No changes to commit"
          else
            git commit -m "‚úÖ Added/Updated schedule to run every 10 minutes"
            git push
          fi
