name: All workflowЁЯСМ

on:
  schedule:
    # ржкрзНрж░рждрж┐ рззрзж ржорж┐ржирж┐ржЯ ржкрж░ ржкрж░ рж░рж╛ржи ржХрж░ржмрзЗ (Cron рж╕рж┐ржиржЯрзНржпрж╛ржХрзНрж╕)
    - cron: '*/10 * * * *'
  workflow_dispatch:  # ржорзНржпрж╛ржирзБржпрж╝рж╛рж▓рж┐ рж░рж╛ржи ржХрж░рж╛рж░ ржЕржкрж╢ржи

jobs:
  update-all-workflows:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Update all workflow YML files
        run: |
          # Workflow ржбрж┐рж░рзЗржХрзНржЯрж░рж┐рждрзЗ ржпрж╛ржи
          cd .github/workflows
          
          # ржкрзНрж░рждрж┐ржЯрж┐ YML ржлрж╛ржЗрж▓рзЗрж░ ржЬржирзНржп (ржирждрзБржи ржлрж╛ржЗрж▓ ржмрзНржпрждрзАржд)
          for file in *.yml; do
            if [ "$file" != "update-all-workflows.yml" ]; then
              echo "Updating schedule in: $file"
              
              # 1. schedule рж╕рзЗржХрж╢ржи ржЦрзБржБржЬрзЗ ржмрзЗрж░ ржХрж░рзЗ cron ржЖржкржбрзЗржЯ ржХрж░рзБржи
              # ржпржжрж┐ schedule already exists, update it
              if grep -q "schedule:" "$file"; then
                # Existing schedule ржЖржкржбрзЗржЯ ржХрж░рзБржи
                sed -i '/schedule:/,/cron:/s/cron:.*/cron: "\/\*\/10 * * * *"/' "$file"
              else
                # ржирждрзБржи schedule ржпрзЛржЧ ржХрж░рзБржи (ржпржжрж┐ workflow ржбрж┐рж╕ржкрзНржпрж╛ржЪ ржмрж╛ ржЕржирзНржпрж╛ржирзНржп ржЯрзНрж░рж┐ржЧрж╛рж░ ржерж╛ржХрзЗ)
                # ржПржЗ ржЕржВрж╢ржЯрж┐ ржЖржкржирж╛рж░ workflow ржПрж░ рж╕рзНржЯрзНрж░рж╛ржХржЪрж╛рж░ ржЙржкрж░ ржирж┐рж░рзНржнрж░ ржХрж░ржмрзЗ
                echo "Note: $file doesn't have a schedule section"
              fi
              
              # 2. ржЕржержмрж╛, alternative approach: sed ржжрж┐ржпрж╝рзЗ рж╕рж░рж╛рж╕рж░рж┐ ржкрж░рж┐ржмрж░рзНрждржи
              # ржПржЗ рж▓рж╛ржЗржиржЯрж┐ ржкрзНрж░рждрж┐ рззрзж ржорж┐ржирж┐ржЯрзЗрж░ cron рж╕рзЗржЯ ржХрж░ржмрзЗ ржпрзЗржЦрж╛ржирзЗ schedule ржЖржЫрзЗ
              sed -i 's/cron:.*/cron: "\/\*\/10 * * * *"/g' "$file"
            fi
          done
      
      - name: Commit and push changes
        run: |
          # ржкрж░рж┐ржмрж░рзНрждржи commit ржХрж░рзБржи
          git config --global user.name 'GitHub Action'
          git config --global user.email 'action@github.com'
          git add .github/workflows/*.yml
          
          # рж╢рзБржзрзБ ржкрж░рж┐ржмрж░рзНрждржи ржерж╛ржХрж▓рзЗ commit ржХрж░рзБржи
          if git diff --staged --quiet; then
            echo "No changes to commit"
          else
            git commit -m "ЁЯФД Update all workflow schedules to run every 10 minutes"
            git push
          fi
